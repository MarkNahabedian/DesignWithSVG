<html>
  <head>
    <title>MediaBox -- Stackable Boxes for Storing CDs and DVDs</title>
    <link rel="stylesheet"  type="text/css" href="shaper_origin.css">
    <style type="text/css">

div.svg-border  { border-width: 5px; border-color: green; }
.guide-line  { stroke-width: .03; }
.outside-cut { stroke-width: .02; }

    </style>
    <script type="text/javascript" src="svg_lib.js"></script>
    <script type="text/javascript">
//<![CDATA[

class Geometry {
  constructor() {
    // All dimensions are in inches unless otherwise stated.

    this.svg_margin = 0.25;

    // Dimension constraints imposed by the media and its packaging
    this.inside_width = 5;      // Based on height of a CD jewel case.
    this.inside_length = 7.75;  // Based on height of a DVD boxed set.
    this.inside_depth = 5.75;   // Based on distance from CD jewel case spine to open end.

    this.wood_thickness = 0.25;      // TODO: measure the wood we are using.

    // Dimensions I've chosen
    // We add tabs that descend from the bottom of the box edges into
    // cutouts in the edges of the box it's stacked on.
    // The top cutout and the bottom extension will be the shape of a
    // 45 degree isosolese trapezoid of this height:
    this.stack_tab_depth = 0.75;
    // The top edge of each corner of the box will be at the full
    // depth of the box.
    // We make sure that at each corner there will be 1/4 inch (inside
    // dimension) that at full height:
    this.full_height_corner = 0.25;

    this.outside_length = this.inside_length + 2 * this.wood_thickness;
    this.outside_width = this.inside_width + 2 * this.wood_thickness;
    this.outside_depth = this.inside_depth + this.wood_thickness;

    // Positioning bottom mortises and tenons and end and side box joints:
  }

  svgWidth() {
    return this.inside_length + 2 * (this.wood_thickness + this.svg_margin);
  }

  svgHeight() {
    return this.inside_depth + this.stack_tab_depth + 2 * this.svg_margin;
  }

  // Returns an SVG path element of a guideline box.
  guide_box(parent, start_x, start_y, dx, dy) {
    var p = path(parent, [
        ['M', this.svg_margin + start_x, this.svg_margin + start_y],
        ['h', dx],
        ['v', dy],
        ['h', - dx],
        ['v', - dy]
        ]);
    p.setAttribute('class', 'guide-line');
    return p;
  }

  update_side_svg(image_element) {
    setupSVGViewport(image_element, 0, 0, geometry.svgWidth(), geometry.svgHeight(), 'in');
    var g = document.createElementNS(svgURI, "g");
    image_element.appendChild(g);
    // TODO: add finger joints
    var edge_path = [];
    var end = this.wood_thickness + this.full_height_corner;
    // Length of the shorter base of the trapezoid that makes up the
    // stacking tab.
    var minor_base = this.inside_length -
                     2 * (this.full_height_corner + this.stack_tab_depth);

    var geo = this;

    function start() {
      edge_path.push(['M', geo.svg_margin, geo.svg_margin]);
    }
    function across() {
      edge_path.push(['h', end]);
      edge_path.push(['l', geo.stack_tab_depth, geo.stack_tab_depth]);
      edge_path.push(['h', minor_base]);
      edge_path.push(['l', geo.stack_tab_depth, - geo.stack_tab_depth]);
      edge_path.push(['h', end]);
    }
    function down() {
      edge_path.push(['l', 0, (geo.inside_depth + geo.wood_thickness)]);
    }

    start(); across(); down();
    start(); down(); across();
    var p = path(g, edge_path);
    p.setAttribute('class', 'outside-cut');

    // TODO:  add mortises for base.

    // Some guide lines
    this.guide_box(g, this.wood_thickness, 0, this.inside_length, this.inside_depth);
    this.guide_box(g, 0, 0, this.outside_length, this.outside_depth);
  }

  update_end_svg(image_element) {
    setupSVGViewport(image_element, 0, 0, geometry.svgWidth(), geometry.svgHeight(), 'in');
    var g = document.createElementNS(svgURI, "g");
    image_element.appendChild(g);
    // TODO: add finger joints
    var edge_path = [];
    edge_path.push(['M', this.svg_margin, this.svg_margin]);
    var end = this.wood_thickness + this.full_height_corner;
    var minor_base = this.inside_width -
                     2 * (this.full_height_corner + this.stack_tab_depth);

    var geo = this;

    function start() {
      edge_path.push(['M', geo.svg_margin, geo.svg_margin]);
    }
    function across() {
      edge_path.push(['h', end]);
      edge_path.push(['l', geo.stack_tab_depth, geo.stack_tab_depth]);
      edge_path.push(['h', minor_base]);
      edge_path.push(['l', geo.stack_tab_depth, - geo.stack_tab_depth]);
      edge_path.push(['h', end]);
    }
    function down() {
      edge_path.push(['l', 0, (geo.inside_depth + geo.wood_thickness)]);
    }

    start(); across(); down();
    start(); down(); across();
    // Draw it
    var p = path(g, edge_path);
    p.setAttribute('class', 'outside-cut');
    // TODO:  add mortises for base.

    // Some guide lines
    this.guide_box(g, this.wood_thickness, 0, this.inside_width, this.inside_depth);
    this.guide_box(g, 0, 0, this.outside_width, this.outside_depth);
  }

  update_bottom_svg(image_element) {
    setupSVGViewport(image_element, 0, 0, geometry.svgWidth(), geometry.svgHeight(), 'in');
    var g = document.createElementNS(svgURI, "g");
    image_element.appendChild(g);
    // TODO: add tenons.
    var edge_path = [];
    edge_path.push(['M', this.svg_margin, this.svg_margin]);
    edge_path.push(['v', this.outside_width]);
    edge_path.push(['h', this.outside_length]);
    edge_path.push(['v', - this.outside_width]);
    edge_path.push(['h', - this.outside_length]);
    var p = path(g, edge_path);
    // p.setAttribute('class', 'outside-cut');

    // Some guide lines
    this.guide_box(g, this.wood_thickness, this.wood_thickness, this.inside_length, this.inside_width);
    this.guide_box(g, 0, 0, this.outside_length, this.outside_width);
  }
}


geometry = new Geometry();

function contentLoaded() {
  setSVGNamespaces();
  geometry.update_side_svg(document.getElementById('side-image'));
  showSVG(document.getElementById('side-image'),
          document.getElementById('side-code'));

  geometry.update_end_svg(document.getElementById('end-image'));
  showSVG(document.getElementById('end-image'),
          document.getElementById('end-code'));

  geometry.update_bottom_svg(document.getElementById('bottom-image'));
  showSVG(document.getElementById('bottom-image'),
          document.getElementById('bottom-code'));  
}

document.addEventListener("DOMContentLoaded", contentLoaded, false);

//]]>
    </script>
  </head>
  <body>

    <h2>Side</h2>

    <pre id="side-code"> </pre>
    <div style="margin:0.5in; border-width: 5px; border-color: green;">
      <svg id="side-image"> </svg>
    </div>


    <h2>End</h2>

    <pre id="end-code"> </pre>
    <div style="margin:0.5in; border-width: 5px; border-color: green;">
      <svg id="end-image"> </svg>
    </div>


    <h2>Bottom</h2>

    <pre id="bottom-code"> </pre>
    <div style="margin:0.5in;" class="svg-border">
      <svg id="bottom-image"> </svg>
    </div>

  </body>
</html>


    
